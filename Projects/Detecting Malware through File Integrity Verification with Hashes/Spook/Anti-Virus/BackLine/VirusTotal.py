import requests
import webbrowser

# VirusTotal API key (replace with your own key)
API_KEY = 'YOUR_API_KEY'

def check_url_safety(url):
    params = {'apikey': API_KEY, 'resource': url}
    headers = {
        "Accept-Encoding": "gzip, deflate",
        "User-Agent": "gzip,  My Python requests library example client or username"
    }

    # Make the request to VirusTotal
    response = requests.get('https://www.virustotal.com/vtapi/v2/url/report', params=params, headers=headers)
    
    try:
        json_response = response.json()
    except requests.exceptions.JSONDecodeError:
        return "Invalid JSON response from VirusTotal."

    # Check the response from VirusTotal
    if response.status_code == 200:
        if json_response['response_code'] == 1:
            total_votes = json_response['total']
            positive_votes = json_response['positives']
            negative_votes = total_votes - positive_votes

            # Check if the majority of vendors marked the URL as safe or unsafe
            if positive_votes > negative_votes:
                return "The URL is safe."
            else:
                return "The URL is not safe."
        else:
            return "The URL is not present in VirusTotal's database."
    else:
        return "An error occurred while contacting VirusTotal."

# Ask for user input
url = input("Enter the URL: ")

# Check URL safety
result = check_url_safety(url)
print(result)

# Ask if the user wants to generate the report
generate_report = input("Generate the VirusTotal report? (yes/no): ")

if generate_report.lower() == 'yes':
    # Open the VirusTotal report in the default browser
    webbrowser.open(f"https://www.virustotal.com/gui/url/{url}/detection")
